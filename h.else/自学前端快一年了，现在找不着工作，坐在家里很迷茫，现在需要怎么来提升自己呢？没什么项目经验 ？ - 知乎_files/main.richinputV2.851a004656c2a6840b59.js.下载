(window.webpackJsonp=window.webpackJsonp||[]).push([[124,34],{1011:function(e,n,t){"use strict";t.d(n,"a",(function(){return r}));var r=function(e){return{display:"-webkit-box",textOverflow:"ellipsis",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:e}}},1014:function(e,n,t){"use strict";(function(e){t.d(n,"a",(function(){return E})),t.d(n,"b",(function(){return L})),t.d(n,"c",(function(){return F})),t.d(n,"d",(function(){return T})),t.d(n,"e",(function(){return G}));var r=t(29),i=t.n(r),a=t(30),o=t.n(a),c=t(40),u=t.n(c),s=t(123),l=t.n(s),d=t(63),f=t(0),p=t(146),h=t.n(p),m=t(507),v=t(508),w=t(46),g=t(135),b=t.n(g),y=t(309),j=t.n(y),O=["preset","onClick","as","inputRef","multiple","maxSize","disabled"];function k(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8;return new Promise((function(r,i){var a=new FileReader;a.onload=function(){a.result instanceof ArrayBuffer?r(a.result):i(null)},a.onerror=function(){return i(null)},a.readAsArrayBuffer(e.slice(n,t))}))}var x,R=(x=[60,115,118,103],function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{offset:0};return x.every((function(t,r){return t===e[n.offset+r]}))}),z=function(){var e=l()(u.a.mark((function e(n){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(n,0,8);case 3:return t=e.sent,e.abrupt("return",new Uint8Array(t));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=l()(u.a.mark((function e(n){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(n);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",R(t));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),E={content:"content",avatar:"avatar"},S={code:1,message:"当前素材文件过大，请重新上传"},A={code:2,message:"当前素材尺寸过大，请重新上传"},P={code:3,message:"当前素材尺寸过小，请重新上传"},N={code:4,message:"素材文件加载失败"},V={code:5,message:"暂不支持当前类型文件"},I=function(e){return new Promise((function(n){var t=new Image;t.onload=function(){n({error:null,image:t})},t.onerror=function(e){n({image:t,error:e})};try{t.src=URL.createObjectURL(e)}catch(e){n({image:t,error:e})}}))};function L(e){return K.apply(this,arguments)}function K(){return(K=l()(u.a.mark((function e(n){var t,r,i,a,o,c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.file,r=n.preset,i=n.maxSize,e.next=3,I(t);case 3:return a=e.sent,o=a.error,c=a.image,e.next=8,_(t);case 8:return s=e.sent,e.abrupt("return",new Promise((function(e,n){if(s)n(V);else if(o)n(Object.assign(Object.assign({},N),{},{error:o}));else{var a=t.size,u=c.width,l=c.height;i&&"number"==typeof i&&a>1024*i*1024?n(S):(r===E.avatar?a>5242880&&n(S):r===E.content&&"image/gif"===(null==t?void 0:t.type)?(a>10485760&&n(S),Math.max(u,l)>1280&&n(A),Math.min(u,l)<120&&n(P)):r===E.content&&(a>20971520&&n(S),Math.max(u,l)>16384&&n(A)),e(t))}})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U={avatar:{accept:[".jpg",".jpeg",".png",".gif",".webp"].join(",")},content:{accept:[".jpg",".jpeg",".png",".gif",".webp"].join(",")}},F=Object(f.forwardRef)((function(e,n){var t=e.preset,r=e.onClick,i=e.as,a=void 0===i?"div":i,c=e.inputRef,u=e.multiple,s=void 0!==u&&u,l=e.maxSize,p=e.disabled,m=void 0!==p&&p,v=o()(e,O),w=Object(f.useRef)(),g=Object(f.useCallback)((function(e,n){var r=v.beforeUpload,i=v.customUpload,a=v.onStart,o=v.onSuccess,c=v.onError;if((!r||r(e))&&i){var u={file:e,uid:n,status:"uploading"};a&&a(u),Promise.resolve().then((function(){return L({file:e,preset:t,maxSize:l})})).then((function(){return i({file:e})})).then((function(e){o&&o(Object.assign(Object.assign({},u),{},{status:"success",remoteInfo:e}))})).catch((function(e){c&&c(Object.assign(Object.assign({},u),{},{status:"error",remoteInfo:e}))})).finally((function(){var e;(null===(e=w.current)||void 0===e?void 0:e.value)&&(w.current.value="")}))}}),[l,t,v]),b=Object(f.useCallback)((function(e){var n=h()(),t=Array.prototype.slice.call(e);s?t.map((function(e){return g(e,n)})):g(t[0],n)}),[s,g]),y=Object(f.useCallback)((function(e){var n;null===(n=w.current)||void 0===n||n.click(),r&&r(e)}),[w,r]),j=Object(f.useCallback)((function(e){var n=e.target.files;n&&n.length&&b(n)}),[b]);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(a,{ref:n,onClick:y,children:v.children}),Object(d.jsx)("input",{type:"file",accept:v.accept?v.accept:U[t].accept,style:{display:"none"},ref:c,multiple:s,disabled:m,onChange:j})]})}));function T(e){return n=e,"[object File]"!==Object.prototype.toString.call(n)?Promise.resolve(e):m.readOrientationCode(e).then((function(n){if(-1===n||1===n)return e;var t,r=window.URL.createObjectURL(e);return(t=r,new Promise((function(e,n){var r=new Image;r.src=t,r.onload=function(){return e(r)},r.onerror=n}))).then((function(e){return window.URL.revokeObjectURL(r),t=Object(v.drawImage)(e,n),new Promise((function(e){return t.toBlob(e,"image/jpeg")}));var t}))})).catch((function(){return e}));var n}var M=b()((function(e,n){return new Promise((function(t,r){var i=document.createElement("script");Object.assign(i,Object.assign({crossOrigin:""},n)),i.onload=function(){return t(i)},i.onerror=function(){return r(new Error("Load script from ".concat(e," failed")))},i.src=e;var a=document.head||document.getElementsByTagName("head")[0];(document.body||a).appendChild(i)}))})),B=function(){return"undefined"!=typeof window?location.host.includes("zhihu.dev"):void 0!==e&&"testing"===e.env.ZAE_ENV},C=function(){return"https://api.zhihu.".concat(B()?"dev":"com")};function D(e){var n=e.accessKeyId,t=e.accessKeySecret,r=e.stsToken;return M("https://unpkg.zhimg.com/ali-oss@6.8.0/dist/aliyun-oss-sdk.min.js").then((function(){return new window.OSS(Object.assign(Object.assign({},B()?{endpoint:"https://oss-cn-beijing.aliyuncs.com",bucket:"zhihu-pics-dev",cname:!1}:{endpoint:"https://zhihu-pics-upload.zhimg.com",bucket:"zhihu-pics",cname:!0}),{},{secure:!0,accessKeyId:n,accessKeySecret:t,stsToken:r}))}))}function Z(e){var n=e.uploadId,t=e.objectKey,r=e.file,i=e.client,a=e.onProgress;return Promise.resolve(n&&i.listParts(t,n).then((function(e){return function(e,n){var t=n.uploadId,r=n.parts,i=n.name;return{file:e,uploadId:t,doneParts:r.map((function(e){var n=e.PartNumber;return{etag:e.ETag,number:Number(n)}})),partSize:Number(r[0].Size),name:i,fileSize:e.size}}(r,e)}))).then((function(e){return function e(n){var t=n.client,r=n.file,i=n.objectKey,a=n.onProgress,o=n.checkpoint,c=o;return t.multipartUpload(i,r,Object.assign({progress:function(e,n,t){if(c=n,a)return a(e,n,t)},mime:r.type,parallel:3,timeout:2e5,partSize:1048576},o&&{checkpoint:o})).catch((function(n){if(c!==o)return e({client:t,objectKey:i,file:r,checkpoint:c});throw n}))}({client:i,file:r,checkpoint:e,onProgress:a,objectKey:t})}))}function J(e,n,t){return n=n||0,t=t||e.size,new Promise((function(r,i){var a=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=new j.a.ArrayBuffer,c=new FileReader;c.onload=function(e){o.append(e.target.result);var n=o.end();r(n)},c.onerror=function(){i()},c.readAsArrayBuffer(a.call(e,n,t))}))}function W(e){return new Promise((function(n){if(e.size>52428800)return Promise.all([J(e,0,10485760),J(e,Math.floor(26214400),Math.floor(26214400)+10485760),J(e,41943040,52428800)]).then((function(t){return n(j.a.hash(t.join("")+e.size))}));J(e).then((function(e){return n(e)}))}))}function H(e){var n=e.id,t=e.uploadResult;return fetch("".concat(C(),"/images/").concat(n,"/uploading_status"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({upload_result:t})})}function q(e){var n=e.file,t=e.hash,r=e.source,i=e.objectKey;if(!r)try{var a=new URL(location.href),o=a.hostname,c=a.pathname.match(/^\/([\w|-]+).*/),u="".concat(o,"/").concat(c?c[1]:"index");w.b.increment("imageUpload.components.default.no_source.".concat(u,".count"))}catch(e){console.warn(e)}return function(e){var n=e.hash,t=e.source;return fetch("".concat(C(),"/images"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({image_hash:n},t&&{source:t}))}).then((function(e){return e.status<=300?e.json():e.text().then((function(n){var t=new Error(n);throw t.status=e.status,t}))})).then((function(e){var n=e.upload_file,t=e.upload_token;return{uploadFile:{id:n.image_id,objectKey:n.object_key,state:n.state,uploadId:n.upload_id},uploadToken:t&&{accessKeyId:t.access_id,accessKeySecret:t.access_key,accessTimestamp:t.access_timestamp,accessToken:t.access_token,stsToken:t.access_token}}}))}({hash:t,source:r}).then((function(e){var a=e.uploadFile,o=e.uploadToken;return 1===a.state?a:D({accessKeyId:o.accessKeyId,accessKeySecret:o.accessKeySecret,stsToken:o.stsToken}).then((function(e){var o=a.objectKey,c=a.uploadId;return n.size<2097152?function(e){var n=e.client,t=e.objectKey,r=e.file;return n.put(t,r)}({objectKey:o,client:e,file:n}):Z({objectKey:o,uploadId:c,client:e,file:n}).catch((function(e){if("SecurityTokenExpired"===e.code&&i!==a.objectKey)return q({file:n,objectKey:a.objectKey,hash:t,source:r});throw e}))})).then((function(){return H({id:a.id,uploadResult:"success"}).then((function(){return a}))}),(function(e){throw H({id:a.id,uploadResult:"fail"}),e}))}))}function G(e,n){var t=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jpg";return e.type?e.type.split("/").pop():e.name?e.name.split(".").pop():n}(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.source,r=n.shouldRotateFromOrientation,i=void 0===r||r;return(i?T(e):Promise.resolve(e)).then((function(e){return W(e).then((function(n){return q({file:e,hash:n,source:t})}))}))}(e,n).then((function(e){return(n=function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return n().then((function(r){return r||t>0&&e(n,t-1)}))}((function(){return n={id:e.id},t=n.id,fetch("".concat(C(),"/images/").concat(t),{credentials:"include",headers:{"Content-Type":"application/json"}}).catch((function(){return null})).then((function(e){return e&&(e.status<=300?e.json():e.text().then((function(n){var t=new Error(n);throw t.status=e.status,t})))})).then((function(e){return!e||"init"!==e.status&&"processing"!==e.status?e:null}));var n,t}),1/0),t=3e4,Promise.race([n,new Promise((function(e,n){return setTimeout((function(){return n(new Error("timeout error: ".concat(r)))}),t)}))])).catch((function(n){throw H({id:e.id,uploadResult:"timeout"}),n}));var n,t,r})).then((function(n){if(n&&"success"===n.status)return(r=URL.createObjectURL(e),new Promise((function(e,n){var t=new Image;t.onload=function(){e(t)},t.onerror=n,t.src=r}))).then((function(e){return Object.assign(Object.assign({},Object.keys(n).reduce((function(e,n){return n.endsWith("src")?Object.assign(Object.assign({},e),{},i()({},n,[e[n],t].join("."))):e}),n)),{},{data_rawwidth:e.width,data_rawheight:e.height,src:[n.original_src,t].join("."),hash:n.original_hash})}));var r,a=new Error(n&&n.status||"unknown");throw a.name="UploadImageError",a}))}}).call(this,t(223))},1123:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return c}));var r=t(0),i=t.n(r),a=t(12),o=Object.assign;function c(e){return i.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowDownSmall24","data-old-api":"ArrowDownSmall24"},e),{className:"ZDI ZDI--ArrowDownSmall24"+(e.className?" ".concat(e.className):"")}),i.a.createElement("path",{d:"M12 13.248L8.22 9.223a.684.684 0 00-1.01 0 .796.796 0 000 1.075l4.15 4.42a.867.867 0 001.28 0l4.15-4.42a.796.796 0 000-1.075.684.684 0 00-1.01 0L12 13.248z",fillRule:"evenodd",clipRule:"evenodd"}))}function u(e){return i.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowDownSmall24","data-old-api":"ArrowDown"},e),{className:"Zi Zi--ArrowDown"+(e.className?" ".concat(e.className):"")}),i.a.createElement("path",{d:"M12 13.248L8.22 9.223a.684.684 0 00-1.01 0 .796.796 0 000 1.075l4.15 4.42a.867.867 0 001.28 0l4.15-4.42a.796.796 0 000-1.075.684.684 0 00-1.01 0L12 13.248z",fillRule:"evenodd",clipRule:"evenodd"}))}},1202:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var r=t(260),i=function(){return Object(r.b)().isDarkMode?{}:{filter:"brightness(0.95)"}}},1217:function(e,n,t){var r=t(678),i=t(680),a=t(505),o=t(679);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},1220:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return c}));var r=t(0),i=t.n(r),a=t(12),o=Object.assign;function c(e){return i.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowRightAlt24","data-old-api":"ArrowRightAlt24"},e),{className:"ZDI ZDI--ArrowRightAlt24"+(e.className?" ".concat(e.className):"")}),i.a.createElement("path",{d:"M14.727 11.48a.63.63 0 010 1.04l-4.299 2.88c-.399.266-.926-.029-.926-.52V9.12c0-.491.527-.787.926-.52l4.299 2.88z"}))}function u(e){return i.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowRightAlt24","data-old-api":"TriangleArrowRight"},e),{className:"Zi Zi--TriangleArrowRight"+(e.className?" ".concat(e.className):"")}),i.a.createElement("path",{d:"M14.727 11.48a.63.63 0 010 1.04l-4.299 2.88c-.399.266-.926-.029-.926-.52V9.12c0-.491.527-.787.926-.52l4.299 2.88z"}))}},1317:function(e,n,t){"use strict";t.d(n,"a",(function(){return v})),t.d(n,"b",(function(){return w}));var r=t(30),i=t.n(r),a=t(1),o=t(0),c=t(143),u=t(135),s=t.n(u),l=t(13),d=t.n(l),f=t(59),p=["className","url","size","round"],h=s()(c.findImageSpec),m=function(e,n){return Object(c.imgUrl)(e,h(n,"square"))},v="https://pic1.zhimg.com/v2-d41c2ceaed8f51999522f903672a521f.jpeg",w=function(e){var n=e.className,t=e.url,r=void 0===t?"https://pic1.zhimg.com/v2-abed1a8c04700ba7d72b45195223e0ff.jpeg":t,c=e.size,u=void 0===c?24:c,s=e.round,l=i()(e,p),h=Object(o.useMemo)((function(){return s?"50%":u>=60?"4px":u>=40?"3px":"2px"}),[s,u]);return Object(a.b)(f.Image,Object.assign({css:{borderRadius:h},bg:"GBK99A",className:d()("Avatar",n),size:u,src:m(r,u),srcSet:"".concat(m(r,2*u)," 2x")},l))}},1454:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return c}));var r=t(0),i=t.n(r),a=t(12),o=Object.assign;function c(e){return i.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowUpSmall24","data-old-api":"ArrowUpSmall24"},e),{className:"ZDI ZDI--ArrowUpSmall24"+(e.className?" ".concat(e.className):"")}),i.a.createElement("path",{d:"M12 10.752l3.78 4.025a.684.684 0 001.01 0 .796.796 0 000-1.075l-4.15-4.42a.866.866 0 00-1.28 0l-4.15 4.42a.796.796 0 000 1.075.684.684 0 001.01 0L12 10.752z",fillRule:"evenodd",clipRule:"evenodd"}))}function u(e){return i.a.createElement(a.a,o(o({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ArrowUpSmall24","data-old-api":"ArrowUp"},e),{className:"Zi Zi--ArrowUp"+(e.className?" ".concat(e.className):"")}),i.a.createElement("path",{d:"M12 10.752l3.78 4.025a.684.684 0 001.01 0 .796.796 0 000-1.075l-4.15-4.42a.866.866 0 00-1.28 0l-4.15 4.42a.796.796 0 000 1.075.684.684 0 001.01 0L12 10.752z",fillRule:"evenodd",clipRule:"evenodd"}))}},926:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.onFullyViewedOnce=n.isFullyViewed=n.onViewedOnce=n.isViewed=void 0;var r=t(947);Object.defineProperty(n,"isViewed",{enumerable:!0,get:function(){return r.isViewed}}),Object.defineProperty(n,"onViewedOnce",{enumerable:!0,get:function(){return r.onViewedOnce}});var i=t(948);Object.defineProperty(n,"isFullyViewed",{enumerable:!0,get:function(){return i.isFullyViewed}}),Object.defineProperty(n,"onFullyViewedOnce",{enumerable:!0,get:function(){return i.onFullyViewedOnce}})},947:function(e,n,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.onViewedOnce=n.isViewed=void 0;var i=r(t(375));n.isViewed=function(e){if(!document.body||!document.body.contains(e))return!1;var n=e.getBoundingClientRect(),t=document.documentElement;return n.bottom<(window.innerHeight||t.clientHeight)};var a=function(){};n.onViewedOnce=function(e,t,r){if(n.isViewed(e))return t.call(r,e),a;var o=i.default((function(){n.isViewed(e)&&(t.call(r,e),c())}),250);function c(){window.removeEventListener("scroll",o),window.removeEventListener("resize",o)}return window.addEventListener("scroll",o),window.addEventListener("resize",o),c}},948:function(e,n,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.onFullyViewedOnce=n.isFullyViewed=void 0;var i=r(t(375)),a=r(t(72));n.isFullyViewed=function(e,n){var t=e.getBoundingClientRect(),r=t.right,i=t.bottom,a=n.getBoundingClientRect(),o=a.right;return i<=a.bottom&&r<=o},n.onFullyViewedOnce=function(e,t,r,o){if(n.isFullyViewed(e,t))return r.call(o,e),a.default;var c=i.default((function(){n.isFullyViewed(e,t)&&(r.call(o,e),u())}),250);t.addEventListener("scroll",c),t.addEventListener("resize",c);var u=function(){t.removeEventListener("scroll",c),t.removeEventListener("resize",c)};return u}}}]);
//# sourceMappingURL=main.richinputV2.851a004656c2a6840b59.js.map